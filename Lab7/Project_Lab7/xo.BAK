constants
	slst=symbol*
%BEGIN xo_game, CreateParms
  dlg_xo_game_ResID = idd_crosses
  dlg_xo_game_DlgType = wd_Modal
  dlg_xo_game_Help = idh_contents
%END xo_game, CreateParms

predicates


  dlg_xo_game_eh : EHANDLER
  nondeterm message(integer,WINDOW)
  nondeterm go(WINDOW)

clauses

  dlg_xo_game_Create(Parent):-
	win_CreateResDialog(Parent,dlg_xo_game_DlgType,dlg_xo_game_ResID,dlg_xo_game_eh,0).
	
	%click events
	dlg_xo_game_eh(_Win,e_Control(idc_1,_CtrlType,_CtrlWin,_CtlInfo),0):-
		!,
		Han=win_GetCtlHandle(_Win,idc_1),
		win_GetText(Han)="", 
		win_SetText(Han,"X"), 
		go(_Win), 
		!.% if field is clear then set X to there
	
	dlg_xo_game_eh(_Win,e_Control(idc_2,_CtrlType,_CtrlWin,_CtlInfo),0):-
		!,
		Han=win_GetCtlHandle(_Win,idc_2),
		win_GetText(Han)="", 
		win_SetText(Han,"X"), 
		go(_Win),
		!.

	dlg_xo_game_eh(_Win,e_Control(idc_3,_CtrlType,_CtrlWin,_CtlInfo),0):-!,
		Han=win_GetCtlHandle(_Win,idc_3),
		win_GetText(Han)="", 
		win_SetText(Han,"X"), 
		go(_Win), 
		!.

	dlg_xo_game_eh(_Win,e_Control(idc_4,_CtrlType,_CtrlWin,_CtlInfo),0):-!,
		Han=win_GetCtlHandle(_Win,idc_4),
		win_GetText(Han)="", 
		win_SetText(Han,"X"), 
		go(_Win), 
		!.

	dlg_xo_game_eh(_Win,e_Control(idc_5,_CtrlType,_CtrlWin,_CtlInfo),0):-!,
		Han=win_GetCtlHandle(_Win,idc_5),
		win_GetText(Han)="", 
		win_SetText(Han,"X"),
		go(_Win), 
		!.

	dlg_xo_game_eh(_Win,e_Control(idc_6,_CtrlType,_CtrlWin,_CtlInfo),0):-!,
		Han=win_GetCtlHandle(_Win,idc_6),
		win_GetText(Han)="",
		win_SetText(Han,"X"),
		go(_Win),
		!.

	dlg_xo_game_eh(_Win,e_Control(idc_7,_CtrlType,_CtrlWin,_CtlInfo),0):-!,
		Han=win_GetCtlHandle(_Win,idc_7),
		win_GetText(Han)="", 
		win_SetText(Han,"X"),
		go(_Win),
		!.

	dlg_xo_game_eh(_Win,e_Control(idc_8,_CtrlType,_CtrlWin,_CtlInfo),0):-!,
		Han=win_GetCtlHandle(_Win,idc_8),
		win_GetText(Han)="", 
		win_SetText(Han,"X"),
		go(_Win),
		!.

	dlg_xo_game_eh(_Win,e_Control(idc_9,_CtrlType,_CtrlWin,_CtlInfo),0):-!,
		Han=win_GetCtlHandle(_Win,idc_9),
		win_GetText(Han)="", 
		win_SetText(Han,"X"), 
		go(_Win), 
		!.

	dlg_xo_game_eh(_,_,_):-
		!,fail.

	% computer bot logic
	go(_Win):-
		% get events information
		Han1=win_GetCtlHandle(_Win,idc_1), S1=win_GetText(Han1), 
		Han2=win_GetCtlHandle(_Win,idc_2), S2=win_GetText(Han2),
		Han3=win_GetCtlHandle(_Win,idc_3), S3=win_GetText(Han3),
		Han4=win_GetCtlHandle(_Win,idc_4), S4=win_GetText(Han4),
		Han5=win_GetCtlHandle(_Win,idc_5), S5=win_GetText(Han5),
		Han6=win_GetCtlHandle(_Win,idc_6), S6=win_GetText(Han6),
		Han7=win_GetCtlHandle(_Win,idc_7), S7=win_GetText(Han7),
		Han8=win_GetCtlHandle(_Win,idc_8), S8=win_GetText(Han8),
		Han9=win_GetCtlHandle(_Win,idc_9), S9=win_GetText(Han9),
		% algorithm
		makego(S1,S2,S3,S4,S5,S6,S7,S8,S9,Q1,Q2,Q3,Q4,Q5,Q6,Q7,Q8,Q9,Res),	
		% setup new text
		win_SetText(Han1,Q1),	
		win_SetText(Han2,Q2),
		win_SetText(Han3,Q3),
		win_SetText(Han4,Q4),
		win_SetText(Han5,Q5),
		win_SetText(Han6,Q6),
		win_SetText(Han7,Q7),
		win_SetText(Han8,Q8),
		win_SetText(Han9,Q9),
		message(Res,_Win).
    
	message(Res,_Win):-
		Res=1, 
		dlg_MessageBox(
			"End game!",
			"You win!", 
			mesbox_iconInformation, 
			mesbox_buttonsOK,
			mesbox_defaultFirst, mesbox_suspendApplication
		),
		win_Destroy(_Win),
		!;
		
		Res=2, 
		dlg_MessageBox(
			"End game!",
			"You lose!",
			mesbox_iconInformation,
			mesbox_buttonsOK,
			mesbox_defaultFirst,
			mesbox_suspendApplication
		),
		win_Destroy(_Win),
		!;
		
		Res=3, dlg_MessageBox(
			"End game!",
			"Draw. Nobody won", 
			mesbox_iconInformation,
			mesbox_buttonsOK,
			mesbox_defaultFirst, mesbox_suspendApplication
		),
		win_Destroy(_Win),
		!;
		!.
